<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebPhoto Pro - Photoshop Clone</title>
    <style>
        :root {
            --bg-dark: #2b2b2b;
            --bg-panel: #323232;
            --bg-tool: #4a4a4a;
            --text-main: #d9d9d9;
            --accent: #0078d7;
            --border: #1e1e1e;
        }

        * { box-sizing: border-box; user-select: none; }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Menu Bar */
        #menubar {
            height: 30px;
            background-color: #1f1f1f;
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 13px;
            border-bottom: 1px solid #000;
        }
        .menu-item { padding: 5px 10px; cursor: pointer; }
        .menu-item:hover { background-color: var(--accent); color: white; }

        /* Main Workspace */
        #workspace {
            display: flex;
            flex: 1;
            height: calc(100% - 30px);
        }

        /* Toolbar (Left) */
        #toolbar {
            width: 50px;
            background-color: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 5px;
        }
        .tool {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin-bottom: 2px;
            border-radius: 3px;
            font-size: 18px;
            color: #b0b0b0;
        }
        .tool:hover { background-color: var(--bg-tool); }
        .tool.active { background-color: var(--bg-tool); border-left: 2px solid var(--accent); color: white; }
        
        /* Options Bar (Top of Workspace) */
        #options-bar {
            height: 35px;
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 15px;
            font-size: 12px;
        }
        
        /* Canvas Area (Center) */
        #canvas-area {
            flex: 1;
            background-color: #1e1e1e;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            position: relative;
        }
        #main-canvas {
            background-color: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            cursor: crosshair;
        }

        /* Panels (Right) */
        #panels {
            width: 260px;
            background-color: var(--bg-panel);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        .panel-header {
            padding: 8px 10px;
            background-color: #252525;
            font-size: 12px;
            font-weight: bold;
            border-bottom: 1px solid var(--border);
            border-top: 1px solid var(--border);
        }
        .panel-content { padding: 15px; }

        /* Controls */
        input[type="range"] { width: 100%; cursor: pointer; }
        input[type="color"] { border: none; width: 30px; height: 30px; cursor: pointer; background: none; }
        button {
            background-color: #4a4a4a; border: 1px solid #1e1e1e;
            color: white; padding: 5px 10px; cursor: pointer; width: 100%; margin-top: 5px; font-size: 11px;
        }
        button:hover { background-color: #5a5a5a; }

        /* Layers Panel */
        #layer-list {
            flex: 1;
            overflow-y: auto;
            background-color: #2b2b2b;
        }
        .layer-item {
            padding: 10px;
            border-bottom: 1px solid #383838;
            background-color: #323232;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 12px;
        }
        .layer-item.active { background-color: #454545; }
        .layer-eye { margin-right: 10px; color: #aaa; cursor: pointer; }

        /* Utility classes */
        .hidden { display: none !important; }
        
        /* Custom input styling for realism */
        .input-group { margin-bottom: 10px; }
        .input-label { display: block; margin-bottom: 5px; font-size: 11px; color: #aaa; }
    </style>
</head>
<body>

    <div id="menubar">
        <div class="menu-item" onclick="newFile()">File</div>
        <div class="menu-item" onclick="alert('Undo/Redo not implemented in Lite version')">Edit</div>
        <div class="menu-item" onclick="alert('Image adjustments are in the right panel')">Image</div>
        <div class="menu-item">Filter</div>
        <div class="menu-item">View</div>
        <div class="menu-item">Window</div>
        <div class="menu-item">Help</div>
    </div>

    <div id="workspace">
        
        <div id="toolbar">
            <div class="tool active" title="Brush Tool (B)" onclick="setTool('brush')">üñåÔ∏è</div>
            <div class="tool" title="Eraser Tool (E)" onclick="setTool('eraser')">üßº</div>
            <div class="tool" title="Move Tool (V)" onclick="setTool('move')">‚ú•</div>
            <div class="tool" title="Fill Bucket (G)" onclick="setTool('fill')">ü™£</div>
            <div class="tool" title="Eyedropper (I)" onclick="setTool('picker')">üñäÔ∏è</div>
            <div style="flex:1"></div>
            <input type="color" id="primary-color" value="#000000" title="Primary Color">
        </div>

        <div style="flex: 1; display: flex; flex-direction: column;">
            <div id="options-bar">
                <span>Size:</span>
                <input type="range" id="brush-size" min="1" max="100" value="10" style="width: 100px;">
                <span id="brush-size-val">10px</span>
                
                <span style="margin-left: 10px;">Opacity:</span>
                <input type="range" id="brush-opacity" min="1" max="100" value="100" style="width: 100px;">
                <span id="brush-opacity-val">100%</span>

                <span style="margin-left: auto;">Smoothing: 10%</span>
            </div>

            <div id="canvas-area">
                <canvas id="main-canvas" width="800" height="600"></canvas>
            </div>
        </div>

        <div id="panels">
            
            <div class="panel-header">Navigator & Info</div>
            <div class="panel-content" style="height: 150px; display:flex; justify-content:center; align-items:center; color:#555;">
                [Histogram Placeholder]
            </div>

            <div class="panel-header">Adjustments</div>
            <div class="panel-content">
                <div class="input-group">
                    <span class="input-label">Brightness</span>
                    <input type="range" id="adj-brightness" min="-100" max="100" value="0" onchange="applyFilters()">
                </div>
                <div class="input-group">
                    <span class="input-label">Contrast</span>
                    <input type="range" id="adj-contrast" min="-100" max="100" value="0" onchange="applyFilters()">
                </div>
                <div class="input-group">
                    <span class="input-label">Blur</span>
                    <input type="range" id="adj-blur" min="0" max="20" value="0" onchange="applyFilters()">
                </div>
                <button onclick="resetFilters()">Reset Filters</button>
                <button onclick="downloadImage()">Export as JPG</button>
                <input type="file" id="file-upload" style="display: none;" onchange="handleFileUpload(this)">
                <button onclick="document.getElementById('file-upload').click()">Open Image</button>
            </div>

            <div class="panel-header">Layers</div>
            <div id="layer-list">
                <div class="layer-item active">
                    <span class="layer-eye">üëÅÔ∏è</span>
                    <span>Background</span>
                </div>
            </div>
            <div class="panel-header" style="border-top:none; text-align:right;">
                <span style="cursor:pointer; padding:0 10px;" title="New Layer" onclick="alert('Layer support is visual-only in this demo version')">üìÑ +</span>
                <span style="cursor:pointer; padding:0 10px;" title="Delete Layer">üóëÔ∏è</span>
            </div>

        </div>
    </div>

    <script>
        // --- Core Variables ---
        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d');
        let painting = false;
        let currentTool = 'brush';
        let brushSize = 10;
        let brushColor = '#000000';
        let brushOpacity = 1;

        // --- Initialization ---
        // Set white background initially
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // --- Event Listeners ---
        canvas.addEventListener('mousedown', startPosition);
        canvas.addEventListener('mouseup', endPosition);
        canvas.addEventListener('mousemove', draw);
        
        // Input Listeners
        document.getElementById('brush-size').addEventListener('input', (e) => {
            brushSize = e.target.value;
            document.getElementById('brush-size-val').innerText = brushSize + 'px';
        });
        document.getElementById('brush-opacity').addEventListener('input', (e) => {
            brushOpacity = e.target.value / 100;
            document.getElementById('brush-opacity-val').innerText = e.target.value + '%';
        });
        document.getElementById('primary-color').addEventListener('input', (e) => {
            brushColor = e.target.value;
        });

        // --- Drawing Engine ---
        function startPosition(e) {
            painting = true;
            draw(e); // Allow dots
        }

        function endPosition() {
            painting = false;
            ctx.beginPath(); // Reset path to prevent connecting lines
        }

        function draw(e) {
            if (!painting) return;

            // Get correct mouse position relative to canvas
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            if (currentTool === 'brush') {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = `rgba(${hexToRgb(brushColor)}, ${brushOpacity})`;
                
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            } else if (currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out'; // This erases to transparent
                ctx.strokeStyle = `rgba(0,0,0,1)`; // Color doesn't matter for eraser
                
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
                
                // Reset composite operation for other tools
                ctx.globalCompositeOperation = 'source-over';
            }
        }

        // --- Tool Logic ---
        function setTool(tool) {
            currentTool = tool;
            
            // UI Update
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            const map = {
                'brush': 0, 'eraser': 1, 'move': 2, 'fill': 3, 'picker': 4
            };
            document.querySelectorAll('.tool')[map[tool]].classList.add('active');

            // Cursor Update
            if(tool === 'brush' || tool === 'eraser') canvas.style.cursor = 'crosshair';
            else if(tool === 'move') canvas.style.cursor = 'move';
            else canvas.style.cursor = 'default';
        }

        // --- Color Helper ---
        function hexToRgb(hex) {
            const bigint = parseInt(hex.slice(1), 16);
            const r = (bigint >> 16) & 255;
            const g = (bigint >> 8) & 255;
            const b = bigint & 255;
            return `${r},${g},${b}`;
        }

        // --- File Operations ---
        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'webphoto-export.jpg';
            link.href = canvas.toDataURL('image/jpeg', 0.8);
            link.click();
        }

        function handleFileUpload(input) {
            const file = input.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Center image on canvas
                    const x = (canvas.width - img.width) / 2;
                    const y = (canvas.height - img.height) / 2;
                    ctx.drawImage(img, Math.max(0, x), Math.max(0, y), Math.min(canvas.width, img.width), Math.min(canvas.height, img.height));
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }

        function newFile() {
            if(confirm("Clear canvas and start new?")) {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        // --- Filters (CSS-based visual preview) ---
        // Note: Real Photoshop changes pixel data. For speed in this demo, we use CSS filters on the canvas style.
        // To save these filters to the export, we would need to use getImageData/putImageData logic which is much heavier.
        function applyFilters() {
            const b = document.getElementById('adj-brightness').value;
            const c = document.getElementById('adj-contrast').value; // Contrast in CSS is % (100% is normal)
            const bl = document.getElementById('adj-blur').value;
            
            // Convert range to CSS filter format
            // Brightness: 1 is normal. Range -100 to 100 maps to 0.5 to 1.5 roughly
            const brightVal = 1 + (b / 100);
            const contVal = 1 + (c / 100);
            const blurVal = bl + 'px';

            canvas.style.filter = `brightness(${brightVal}) contrast(${contVal}) blur(${blurVal})`;
        }

        function resetFilters() {
            document.getElementById('adj-brightness').value = 0;
            document.getElementById('adj-contrast').value = 0;
            document.getElementById('adj-blur').value = 0;
            applyFilters();
        }
        
        // --- Shortcuts ---
        window.addEventListener('keydown', (e) => {
            if(e.key === 'b') setTool('brush');
            if(e.key === 'e') setTool('eraser');
            if(e.key === '[' && brushSize > 1) { brushSize--; document.getElementById('brush-size').value = brushSize; }
            if(e.key === ']') { brushSize++; document.getElementById('brush-size').value = brushSize; }
        });

    </script>
</body>
</html>
